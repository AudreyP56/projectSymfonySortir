{% extends 'base.html.twig' %}

{% block title %}Hello CreerSortieController!{% endblock %}

{% block body %}
    <h2>Créer une sortie</h2>
    <div class="form-control">
        {{ form_start(creationForm) }}

    <div class="row">
        <div class="col">
            <label class="form-label" for="nom">Nom de la sortie</label>
            <input class="form-control" type="text" id="nom" name="{{ field_name(creationForm.nom) }}">
        </div>

        <div class="col">
            <label class="form-label" for="dateSortie">Date et heure de la sortie</label>
            <input class="form-control" type="datetime-local" id="dateSortie" name="{{ field_name(creationForm.dateHeureSortie) }}">
        </div>
    </div>
        <div class="mb-3">
            <label class="form-label" for="dateLimite">Date limite d'inscription</label>
            <input class="form-control" type="date" id="dateLimite" name="{{ field_name(creationForm.dateLimite) }}">
        </div>
        <div class="mb-3">
            <label class="form-label" for="nbPlace">Nombre de places</label>
            <input class="form-control" type="number" id="nbPlace" name="{{ field_name(creationForm.nbPlace) }}">
        </div>
        <div class="mb-3">
            <label class="form-label" for="duree">Durée</label>
            <input class="form-control" type="number" id="duree" name="{{ field_name(creationForm.duree) }}"> minutes
        </div>
        <div class="mb-3">
            <label class="form-label" for="description">Nom de la sortie</label>
            <textarea class="form-control" name="{{ field_name(creationForm.description) }}" id="description" cols="30" rows="10"></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label" for="duree">Durée</label>
            <input class="form-control" type="number" id="duree" name="{{ field_name(creationForm.duree) }}"> minutes
        </div>
        <div class="mb-3">
            <label class="form-label" for="siteOrganisateur">Site Organisateur</label>
            <input class="form-control" type="text" id="siteOrganisateur" name="{{ field_name(creationForm.siteOrganisateur) }}" value="{{ site.nom }}" disabled>
        </div>
        <div class="mb-3">
            <label class="form-label" for="ville">Ville</label>
            <select class="form-select" id="ville" name="{{ field_name(creationForm.ville) }}" aria-label="Default select example" onchange="chargementLieu()">
                {% for ville in villes %}
                    <option value="{{ ville.id }}" >{{ ville.nom }}</option >
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label" for="lieu">Lieu</label>
            <select class="form-select" id="lieu" name="{{ field_name(creationForm.lieu) }}" aria-label="Default select example" onchange="chargementRue()" >
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label" for="rue">Rue</label>
            <input class="form-control" type="text" id="rue" name="{{ field_name(creationForm.rue) }}" disabled >
        </div>
        <div class="mb-3">
            <label class="form-label" for="codePostal">CodePostal</label>
            <input class="form-control" type="text" id="codePostal" name="{{ field_name(creationForm.codePostal) }}" disabled >
        </div>
        <div class="mb-3">
            <label class="form-label" for="latitude">Latitude</label>
            <input class="form-control" type="text" id="latitude" name="{{ field_name(creationForm.latitude) }}" >
        </div>
        <div class="mb-3">
            <label class="form-label" for="longitude">Longitude</label>
            <input class="form-control" type="text" id="longitude" name="{{ field_name(creationForm.longitude) }}" >
        </div>
        <div  style="padding: 1rem 0;">
            <button type="submit" name="{{ field_name(creationForm.save) }}" class="btn btn-primary">Enregistrer</button>
            <button type="submit" name="{{ field_name(creationForm.saveEtPublier) }}" class="btn btn-success">Publier la sortie</button>
            <button class="btn btn-danger" name="{{ field_name(creationForm.annuler) }}">Annuler</button>
        </div>
        {{ form_end(creationForm) }}
    </div>
    <script>
        function chargementRue(){
            let nomLieu = document.getElementById("lieu").value;
            let inputRue = document.getElementById("rue");
            let inputCodePostal = document.getElementById("codePostal");
            let inputLatitude = document.getElementById("latitude");
            let inputLongitude = document.getElementById("longitude");
            fetch("http://127.0.0.1:8000/listeRue/" + nomLieu)
                .then(response => response.json())
                .then((lieuSelect)=> {
                    for (const lieu of lieuSelect) {
                        inputRue.value = lieu.rue;
                        inputCodePostal.value = lieu.ville.codePostal;
                        inputLatitude.value = lieu.latitude;
                        inputLongitude.value = lieu.longitude;
                    }
                })
        }
    </script>
{% endblock %}

